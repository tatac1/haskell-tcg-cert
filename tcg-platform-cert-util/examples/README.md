# TCG Platform Certificate Utility - Usage Examples

This document provides examples of how to use the `tcg-platform-cert-util` command-line tool.

## Installation

Build and install using Stack:

```bash
stack build tcg-platform-cert-util
```

## Commands Overview

- `generate` - Generate a new TCG Platform Certificate
- `show` - Display certificate information 
- `validate` - Validate certificate structure and attributes
- `components` - Show component and platform information

## Basic Usage

### Generate a Platform Certificate

Generate a basic platform certificate with default settings:

```bash
tcg-platform-cert-util generate \
  --manufacturer "Acme Corp" \
  --model "SecurePlatform 3000" \
  --version "2.1.0" \
  --serial "SP3K-001" \
  --output my-platform.pem
```

Output:
```
Generating platform certificate...
Certificate generated successfully
Certificate written to: my-platform.pem
```

### Generated Certificate Structure

The generated PEM file contains a TCG Platform Certificate with:
- Platform manufacturer, model, version, and serial number
- TPM information (currently dummy data)
- Validity period
- Digital signature (currently dummy signature for testing)

Example generated certificate:

```
-----BEGIN PLATFORM CERTIFICATE-----
MIHcMIGnMIGkAgECoQIwAKAEMAIwADANBgkqhkiG9w0BAQsFAAIBATAcFwwyNDEy
MDEwMDAwMDAXDDI1MTIwMTAwMDAwMDBlMBYGBWeBBQIEMQ0wCwQJQWNtZSBDb3Jw
MCAGBWeBBQIFMRcwFQQTU2VjdXJlUGxhdGZvcm0gMzAwMDAVBgVngQUCBjEMMAoE
CFNQM0stMDAxMBIGBWeBBQIHMQkwBwQFMi4xLjAwDQYJKoZIhvcNAQELBQADIQBC
QkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQg==
-----END PLATFORM CERTIFICATE-----
```

## Command Options

### Generate Command Options

```bash
tcg-platform-cert-util generate --help
```

Available options:
- `-o FILE, --output=FILE` - Output file (default: platform-cert.pem)
- `-m NAME, --manufacturer=NAME` - Platform manufacturer
- `--model=NAME` - Platform model
- `--version=VER` - Platform version
- `-s NUM, --serial=NUM` - Platform serial number
- `--key-size=BITS` - Key size in bits (default: 2048, not yet implemented)
- `--validity=DAYS` - Validity period in days (default: 365, not yet implemented)

## Advanced Examples

### Generate Multiple Certificates

Generate certificates for different platforms:

```bash
# Server platform
tcg-platform-cert-util generate \
  --manufacturer "Dell Inc." \
  --model "PowerEdge R750" \
  --version "1.2" \
  --serial "PE750-12345" \
  --output server-platform.pem

# IoT device platform
tcg-platform-cert-util generate \
  --manufacturer "Raspberry Pi Foundation" \
  --model "Raspberry Pi 4" \
  --version "B+" \
  --serial "RPI4B-67890" \
  --output iot-platform.pem
```

## Integration with x509-util

### Show Command

Display certificate information from a PEM file:

```bash
# Show basic certificate information
tcg-platform-cert-util show my-platform.pem

# Show detailed certificate information (verbose)
tcg-platform-cert-util show --verbose my-platform.pem
```

**Note**: The show command is currently implemented but encounters parsing issues with certificates generated by the current `tcg-platform-cert` library. This is due to ASN.1 structure validation in the issuer field. The command will display the raw certificate information in case of parsing failures.

You can also use the standard `crypton-x509-util` to examine the generated certificates:

```bash
# Display certificate information (basic X.509 structure)
crypton-x509-util cert my-platform.pem
```

### Validate Command

Validate certificate structure, attributes, and validity:

```bash
# Basic validation
tcg-platform-cert-util validate my-platform.pem

# Detailed validation with verbose output
tcg-platform-cert-util validate --verbose my-platform.pem
```

**Example output**:
```
Validating certificate: simple-test.pem

FAILED: Certificate parsing failed
   Error: signed object error: "V2Form: issuerName MUST contain one and only one GeneralName"

=== BASIC ASN.1 VALIDATION ===

1. ASN.1 Structure Check:
   PASSED: ASN.1 parsing successful

2. Certificate Elements Check:
   Sequence structure: PASSED
   Version field: PASSED
   Attribute data: PASSED
```

### Components Command

Extract and display platform component information:

```bash
# Show component information
tcg-platform-cert-util components my-platform.pem

# Show detailed component information with hex dumps
tcg-platform-cert-util components --verbose my-platform.pem
```

**Example output**:
```
Extracting components from: simple-test.pem
Component Analysis from ASN.1 Structure:

=== Platform Attributes ===
  [1] Manufacturer: "Test"
  [2] Model: "Test"
  [3] Serial: "001"
  [4] Version: "1.0"

=== TCG Component OIDs Found ===
  [1] [2,23,133,2,4]
  [2] [2,23,133,2,5]
  [3] [2,23,133,2,6]
  [4] [2,23,133,2,7]
```

## Development Status

Current implementation status:
-  **Generate command** - Working, generates dummy-signed certificates
-  **Show command** - Working with ASN.1 fallback for parsing issues
-  **Validate command** - Working, validates certificate structure and attributes  
-  **Components command** - Working, extracts platform and component information

## Technical Notes

The current implementation:
- Uses dummy signatures for testing purposes
- Supports basic platform identification attributes  
- Outputs standard PEM format compatible with other tools
- Built on the `tcg-platform-cert` Haskell library
- All four commands (generate, show, validate, components) fully implemented
- ASN.1 fallback parsing for certificates that don't parse at the TCG level

**Features**:
- **Certificate Generation**: Creates TCG platform certificates with platform information
- **Information Display**: Shows certificate content via ASN.1 analysis when needed
- **Structure Validation**: Validates ASN.1 structure, required attributes, and basic consistency
- **Component Extraction**: Identifies and displays platform components and TCG attributes

**Known Issues**:
- Generated certificates have ASN.1 structure issues in the issuer field (V2Form validation)
- High-level TCG parsing fails but ASN.1 level parsing provides full functionality
- This is a limitation of the current certificate generation in `tcg-platform-cert` library

For production use, real cryptographic signatures should be implemented using proper private keys and certificate authorities.

## YAML Configuration Examples

This directory contains sample YAML configuration files demonstrating different platform types and component configurations based on the IWG Platform Certificate Profile v1.1 and TCG Component Class Registry v1.0.

### Available Sample Configurations

1. **`enterprise-server.yaml`** - Dell PowerEdge R750 Enterprise Server
   - Dual Intel Xeon CPUs, 64GB ECC memory
   - NVMe SSD storage, enterprise networking
   - 3-year validity period
   - Multiple redundant components

2. **`workstation.yaml`** - HP Z4 G5 Professional Workstation  
   - Intel Xeon W-2245 CPU, 64GB ECC memory
   - NVIDIA RTX A4000 professional graphics
   - Mixed NVMe/SATA storage
   - 4-year validity period

3. **`iot-device.yaml`** - Raspberry Pi 4 Model B IoT Device
   - ARM Cortex-A72 quad-core CPU
   - 8GB LPDDR4 memory, microSD storage
   - WiFi, Bluetooth, Ethernet connectivity
   - 2-year validity period

4. **`edge-gateway.yaml`** - Advantech ARK-3531L Industrial Edge Gateway
   - NXP i.MX 8M Plus ARM processor
   - Industrial-grade components
   - 5G cellular, multiple Ethernet ports
   - 5-year validity period

5. **`embedded-system.yaml`** - STM32MP157F Discovery Kit Embedded System
   - Dual ARM Cortex-A7 + Cortex-M4 cores
   - Embedded-specific peripherals
   - Audio, display, touch interfaces
   - 7-year validity period

### Delta Platform Certificate Examples

Delta Platform Certificates track changes from a base certificate. These examples demonstrate platform updates, component additions, and firmware upgrades:

1. **`enterprise-server-delta.yaml`** - Dell PowerEdge R750 Server Updates
   - UEFI BIOS firmware update (2.15.2 → 2.17.0)
   - Memory expansion (64GB → 128GB)
   - Network card revision update and additional 10GbE NIC
   - Platform version update (2.1.3 → 2.1.4)

2. **`workstation-delta.yaml`** - HP Z4 G5 Workstation Upgrades
   - Graphics card upgrade (RTX A4000 16GB → RTX A6000 48GB)
   - Storage expansion (added 4TB NVMe SSD)
   - Memory expansion (64GB → 128GB ECC)
   - WiFi upgrade (AX201 → AX210 WiFi 6E)

3. **`iot-device-delta.yaml`** - Raspberry Pi 4 IoT Device Enhancements
   - Storage upgrade (128GB → 256GB microSD + 1TB USB SSD)
   - Boot firmware update (2023.12.06 → 2024.01.15)
   - Added PoE+ HAT and environmental sensor
   - WiFi module revision update

4. **`edge-gateway-delta.yaml`** - Advantech ARK-3531L Gateway Expansion
   - 5G modem upgrade (RM502Q-AE → RM520N-GL with mmWave)
   - Added AI accelerator (Google Coral Edge TPU)
   - Added I/O expansion, GPS module, and security element
   - Storage and connectivity enhancements

5. **`embedded-system-delta.yaml`** - STM32MP157F Discovery Kit Updates
   - eMMC storage upgrade (4GB → 8GB)
   - External flash expansion (16MB → 32MB)
   - Added CAN-FD controller and hardware crypto accelerator
   - Enhanced security element and motion sensor

### Using Sample Configurations

Generate certificates using these sample configurations:

#### Base Platform Certificates

```bash
# Generate enterprise server certificate
tcg-platform-cert-util generate \
  --config examples/enterprise-server.yaml \
  --output enterprise-server-cert.pem \
  --ca-cert ca-cert.pem \
  --ca-key ca-key.pem \
  --ek-cert ek-cert.pem

# Generate IoT device certificate  
tcg-platform-cert-util generate \
  --config examples/iot-device.yaml \
  --output iot-device-cert.pem \
  --ca-cert ca-cert.pem \
  --ca-key ca-key.pem \
  --ek-cert ek-cert.pem

# Generate workstation certificate
tcg-platform-cert-util generate \
  --config examples/workstation.yaml \
  --output workstation-cert.pem \
  --ca-cert ca-cert.pem \
  --ca-key ca-key.pem \
  --ek-cert ek-cert.pem
```

#### Delta Platform Certificates

**Note**: Delta certificate generation is currently in development. The YAML examples show the intended structure for future implementation.

```bash
# Generate delta certificate for enterprise server (when implemented)
tcg-platform-cert-util generate-delta \
  --config examples/enterprise-server-delta.yaml \
  --base-cert enterprise-server-cert.pem \
  --output enterprise-server-delta-cert.pem \
  --ca-cert ca-cert.pem \
  --ca-key ca-key.pem

# Generate delta certificate for IoT device (when implemented)
tcg-platform-cert-util generate-delta \
  --config examples/iot-device-delta.yaml \
  --base-cert iot-device-cert.pem \
  --output iot-device-delta-cert.pem \
  --ca-cert ca-cert.pem \
  --ca-key ca-key.pem

# Generate delta certificate for workstation (when implemented)
tcg-platform-cert-util generate-delta \
  --config examples/workstation-delta.yaml \
  --base-cert workstation-cert.pem \
  --output workstation-delta-cert.pem \
  --ca-cert ca-cert.pem \
  --ca-key ca-key.pem
```

### Component Class Reference

The component class values used in these examples follow the TCG Component Class Registry v1.0 specification:

- `00010002` - CPU (Central Processing Unit) - x86/x64
- `00010003` - CPU (Central Processing Unit) - ARM  
- `00020001` - GPU (Graphics Processing Unit) - Integrated
- `00020002` - GPU (Graphics Processing Unit) - Discrete
- `00030003` - Motherboard (includes processor, memory, and I/O)
- `00030004` - System Board - Embedded Systems
- `00040008` - Secure Element
- `00040009` - TPM (discrete Trusted Platform Module)
- `00060003` - DDR3 Memory
- `00060004` - DDR4 Memory  
- `00060005` - LPDDR4 Memory
- `00070001` - Hard Disk Drive (HDD)
- `00070003` - Solid State Drive (SSD)
- `00070004` - SD/MicroSD Card
- `00070005` - NOR Flash Memory
- `00070006` - eMMC Flash Storage
- `00080001` - Ethernet Network Interface
- `00080002` - WiFi Network Interface
- `00080003` - Bluetooth Interface
- `00080004` - Cellular Modem Interface
- `00090001` - USB Hub Controller
- `00090002` - USB OTG Controller
- `000B0001` - Power Supply Unit (PSU)
- `000B0002` - Power Management IC (PMIC)
- `000C0001` - Cooling Fan
- `000D0001` - Camera Interface
- `000D0002` - Display Controller
- `000D0003` - Touch Screen Controller
- `000E0001` - Audio Codec
- `000F0001` - Temperature Sensor
- `00100001` - Serial Communication Interface
- `00100002` - CAN Bus Interface
- `00110001` - Real-Time Clock (RTC)
- `00130001` - Boot ROM
- `00130003` - UEFI System Firmware
- `00130004` - U-Boot/Custom Boot Firmware

These examples demonstrate real-world platform configurations across different deployment scenarios, from high-performance enterprise servers to resource-constrained embedded systems.