{-# LANGUAGE OverloadedStrings #-}
module IanaPenTests (tests) where

import Test.Tasty
import Test.Tasty.HUnit

import Data.X509.TCG.Util.IanaPen

tests :: TestTree
tests = testGroup "IANA PEN Lookup"
  [ exactMatchTests
  , caseInsensitiveTests
  , aliasTests
  , substringFallbackTests
  , penToOidTests
  , reverseTests
  , noMatchTests
  , oidTests
  ]

exactMatchTests :: TestTree
exactMatchTests = testGroup "Exact match"
  [ testCase "Intel" $
      lookupManufacturerPen "Intel" @?= Just 343
  , testCase "Dell" $
      lookupManufacturerPen "Dell" @?= Just 674
  , testCase "Samsung" $
      lookupManufacturerPen "Samsung" @?= Just 236
  , testCase "IBM" $
      lookupManufacturerPen "IBM" @?= Just 2
  , testCase "Apple" $
      lookupManufacturerPen "Apple" @?= Just 63
  ]

caseInsensitiveTests :: TestTree
caseInsensitiveTests = testGroup "Case insensitive"
  [ testCase "intel (lowercase)" $
      lookupManufacturerPen "intel" @?= Just 343
  , testCase "DELL (uppercase)" $
      lookupManufacturerPen "DELL" @?= Just 674
  , testCase "Samsung (mixed)" $
      lookupManufacturerPen "sAmSuNg" @?= Just 236
  ]

aliasTests :: TestTree
aliasTests = testGroup "Alias matching"
  [ testCase "Intel Corporation" $
      lookupManufacturerPen "Intel Corporation" @?= Just 343
  , testCase "Dell Inc." $
      lookupManufacturerPen "Dell Inc." @?= Just 674
  , testCase "Hewlett-Packard" $
      lookupManufacturerPen "Hewlett-Packard" @?= Just 11
  , testCase "Hewlett Packard Enterprise" $
      lookupManufacturerPen "Hewlett Packard Enterprise" @?= Just 47196
  , testCase "Advanced Micro Devices, Inc." $
      lookupManufacturerPen "Advanced Micro Devices, Inc." @?= Just 3704
  , testCase "Apple Computer, Inc." $
      lookupManufacturerPen "Apple Computer, Inc." @?= Just 63
  , testCase "Samsung Electronics Co., LTD." $
      lookupManufacturerPen "Samsung Electronics Co., LTD." @?= Just 236
  , testCase "ASUS" $
      lookupManufacturerPen "ASUS" @?= Just 2623
  , testCase "Western Digital Corporation" $
      lookupManufacturerPen "Western Digital Corporation" @?= Just 5127
  , testCase "Cisco Systems, Inc." $
      lookupManufacturerPen "Cisco Systems, Inc." @?= Just 9
  ]

substringFallbackTests :: TestTree
substringFallbackTests = testGroup "Substring fallback"
  [ testCase "Something Intel Inside" $
      lookupManufacturerPen "Something Intel Inside" @?= Just 343
  , testCase "The Samsung Group" $
      lookupManufacturerPen "The Samsung Group" @?= Just 236
  ]

penToOidTests :: TestTree
penToOidTests = testGroup "PEN to OID"
  [ testCase "Intel OID" $
      penToOid 343 @?= "1.3.6.1.4.1.343"
  , testCase "Dell OID" $
      penToOid 674 @?= "1.3.6.1.4.1.674"
  , testCase "IBM OID" $
      penToOid 2 @?= "1.3.6.1.4.1.2"
  ]

reverseTests :: TestTree
reverseTests = testGroup "Reverse lookup"
  [ testCase "PEN 343 -> Intel" $
      penToManufacturer 343 @?= Just "Intel"
  , testCase "PEN 674 -> Dell" $
      penToManufacturer 674 @?= Just "Dell"
  , testCase "PEN 99999 -> Nothing" $
      penToManufacturer 99999 @?= Nothing
  ]

noMatchTests :: TestTree
noMatchTests = testGroup "No match"
  [ testCase "Unknown vendor returns Nothing" $
      lookupManufacturerPen "Unknown Vendor XYZ" @?= Nothing
  , testCase "Empty string returns Nothing" $
      lookupManufacturerPen "" @?= Nothing
  ]

oidTests :: TestTree
oidTests = testGroup "Manufacturer OID lookup"
  [ testCase "Intel OID" $
      lookupManufacturerOid "Intel Corporation" @?= Just "1.3.6.1.4.1.343"
  , testCase "Dell OID" $
      lookupManufacturerOid "Dell Inc." @?= Just "1.3.6.1.4.1.674"
  , testCase "Unknown returns Nothing" $
      lookupManufacturerOid "Unknown" @?= Nothing
  ]